Script started on Mon 19 Nov 2012 03:03:10 PM EST
[yangx@yangx pilatusDhs]$ llpwdgit rm --cached dump*[27Gpwd[Kll[K[K[Kcd stri[K[K[K[Kscripts/
[yangx@yangx scripts]$ ll
[00mtotal 104
drwxrwxr-x 2 yangx yangx  4096 Jun 12 15:20 [00;34mCVS[00m
-rw-rw-r-- 1 yangx yangx 11153 Aug 22 14:35 [00mDhsProtocol.tcl[00m
-rw-rw-r-- 1 yangx yangx  9374 Apr 22  2010 [00mFileMover.tcl[00m
-rw-rw-r-- 1 yangx yangx 17441 Apr 22  2010 [00mImpWriteFiles.tcl[00m
-rw-rw-r-- 1 yangx yangx  2400 Jul 25 15:56 [00mLogger.tcl[00m
-rw-rw-r-- 1 yangx yangx 25163 Oct 12 17:07 [00mPilatusControl.tcl[00m
-rw-rw-r-- 1 yangx yangx   356 Aug 22 14:42 [00mreadme[00m
-rwxrwxr-x 1 yangx yangx  6442 Aug 24 13:57 [00;32mrun.tcl[00m
-rwxrwxr-x 1 yangx yangx  6499 Jul 25 17:33 [00;32mrun.tcl-ori[00m
drwxrwxr-x 2 yangx yangx  4096 Oct 24 15:08 [00;34mtests[00m
[m[yangx@yangx scripts]$ cd tests/
[yangx@yangx tests]$ ll
[00mtotal 36
-rwxr-xr-x 1 yangx yangx  3664 Oct 12 17:05 [00;32mpilatusServer.tcl[00m
-rwxr-xr-x 1 yangx yangx  2003 Aug 21 11:52 [00;32mpilatusTests.tcl[00m
-rwxr-xr-x 1 yangx yangx  2003 Aug 21 11:27 [00;32mpilatusTests.tcl-modified[00m
-rwxr-xr-x 1 yangx yangx 10417 Aug 21 11:37 [00;32mpilatusTests.tcl-no-good[00m
-rw-r--r-- 1 yangx yangx 10051 Jul 26 11:15 [00mpilatusTests.tcl-ori[00m
[m[yangx@yangx tests]$ vi pilatusServer.tcl 
[?1049h[?1h=[1;56r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[56;1H"pilatusServer.tcl" "pilatusServer.tcl" 120L, 3664C[>c[1;1H[34m#!/usr/bin/tclsh[m

package require Itcl
[33mnamespace[m [35mimport[m itcl::*

[33mset[m i [31m0[m
class MockPilatusServer {
    private [33mvariable[m _socket
[34m    #private variable _exptime ""[m
    public [33mvariable[m _exptime [31m""[m[12;4Hconstructor {port_} {[13;7H[33mif[m {[catch {[14;10Hsocket -server [::itcl::code [36m$this[m accept] [36m$port_[m[15;7H} _socket]} {[16;10Hputs [31m"ERROR Could not create mock server socket for Pilatus: $_socket"[m[17;10H[33mreturn[m -code error[18;9H}[19;9Hputs [31m"MockPilatusServer is establed"[m
   }[22;4Hpublic method accept {sd_ address_ port_} {[23;7Hputs [31m"MOCK PILATUS HANDLE CONNECT $sd_"[m[24;7Hfconfigure [36m$sd_[m -buffering line[25;7Hfileevent [36m$sd_[m readable [::itcl::code [36m$this[m handleClientInput [36m$sd_[m]
   }[28;5Hpublic method handleClientInput { sd_ } {[29;9H[33mif[m {[catch {gets [36m$sd_[m data} rc]} {[30;13H[33mreturn[m[31;9H}[32;9H[33mglobal[m i[33;9H[33mset[m i  [[33mexpr[m [36m$i[m + [31m1[m][34;9Hputs [31m"PILATUS<DHS-YANG: $data $i"[m[35;9H[33mset[m tokens [split [36m$data[m][37;9H[33mswitch[m [[33mlindex[m [36m$tokens[m [31m0[m] {[38;13Hexttrigger {[39;17H[33mif[m {$_exptime==[31m""[m} {[40;21Hputs [31m"[m[30m[43myangx[m[31m1 $sd_ 15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:36:22.2833[41;1H7 ERR"[m[42;21HtoDhs [36m$sd_[m [31m"15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:36:22.2837 ERR"[m[43;21Hafter [[33mexpr[m $_expTime * [31m1000[m] [::itcl::code [36m$this[m sendExposeCompleteResponse [36m$sd_[m $_filenamm[44;1He][45;21H[33mreturn[m[46;17H}[48;17H[33mset[m filename [[33mlindex[m [36m$tokens[m [31m1[m]
[34m#ori-yang       toDhs $sd_ "15 OK Exposure time set to: $_exptime sec.15 OK Starting externally triggered exposs[50;1Hure(s): 2009/Jul/10 10:43:49.748"[m[51;17HtoDhs [36m$sd_[m [31m"15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:43:49.748"[m[52;17Hafter  [[33mexpr[m {int($_exptime*[31m1000[m)}] [::itcl::code [36m$this[m sendExposeCompleteResponse [36m$sd_[m [31m"/home//[m[53;1H[30m[43myangx[m[31m/ptest1"[m]
[34m                #after [expr $_exptime * 1000]
                #::itcl::code $this sendExposeCompleteResponse $sd_ $_filename[m[56;94H1,1           Top[1;1H[?12l[?25hP+q436f\P+q6b75\P+q6b64\P+q6b72\P+q6b6c\P+q2332\P+q2334\P+q2569\P+q2a37\P+q6b31\[?25l[56;94H2,0-1         Top[2;1H[?12l[?25h[?25l[56;94H3,1           Top[3;1H[?12l[?25h[?25l[56;94H4,1           Top[4;1H[?12l[?25h[?25l[56;94H5,0-1         Top[5;1H[?12l[?25h[?25l[56;94H6,1           Top[6;1H[?12l[?25h[?25l[56;94H7,1           Top[7;1H[?12l[?25h[?25l[56;94H8,1           Top[8;1H[?12l[?25h[?25l[56;94H9,1           Top[9;1H[?12l[?25h[?25l[56;94H10,1          Top[10;1H[?12l[?25h[?25l[56;94H11,0-1        Top[11;1H[?12l[?25h[?25l[56;94H12,1          Top[12;1H[?12l[?25h[?25l[56;94H13,1          Top[13;1H[?12l[?25h[?25l[56;94H14,1          Top[14;1H[?12l[?25h[?25l[56;94H15,1          Top[15;1H[?12l[?25h[?25l[56;94H16,1          Top[16;1H[?12l[?25h[?25l[56;94H17,1          Top[17;1H[?12l[?25h[?25l[56;94H18,1-8        Top[18;8H[?12l[?25h[?25l[56;94H19,1-8        Top[19;8H[?12l[?25h[?25l[56;94H20,1          Top[20;1H[?12l[?25h[?25l[56;94H21,0-1        Top[21;1H[?12l[?25h[?25l[56;94H22,1          Top[22;1H[?12l[?25h[?25l[56;94H23,1          Top[23;1H[?12l[?25h[?25l[56;94H24,1          Top[24;1H[?12l[?25h[?25l[56;94H25,1          Top[25;1H[?12l[?25h[?25l[56;94H26,1          Top[26;1H[?12l[?25h[?25l[56;94H27,0-1        Top[27;1H[?12l[?25h[?25l[56;94H28,1          Top[28;1H[?12l[?25h[?25l[56;94H29,1          Top[29;1H[?12l[?25h[?25l[56;94H30,1          Top[30;1H[?12l[?25h[?25l[56;94H31,1          Top[31;1H[?12l[?25h[?25l[56;94H32,1-8        Top[32;8H[?12l[?25h[?25l[56;94H33,1-8        Top[33;8H[?12l[?25h[?25l[56;94H34,1          Top[34;1H[?12l[?25h[?25l[56;94H35,1          Top[35;1H[?12l[?25h[?25l[56;94H36,0-1        Top[36;1H[?12l[?25h[?25l[56;94H37,1          Top[37;1H[?12l[?25h[?25l[56;94H38,1          Top[38;1H[?12l[?25h[?25l[56;94H39,1          Top[39;1H[?12l[?25h[?25l[56;94H40,1          Top[40;1H[?12l[?25h[?25l[56;94H41,1          Top[42;1H[?12l[?25h[?25l[56;94H42,1          Top[43;1H[?12l[?25h[?25l[56;94H43,1          Top[45;1H[?12l[?25h[?25l[56;94H44,1          Top[46;1H[?12l[?25h[?25l[56;94H45,0-1        Top[47;1H[?12l[?25h[?25l[56;94H46,1          Top[48;1H[?12l[?25h[?25l[56;94H47,1          Top[49;1H[?12l[?25h[?25l[56;94H48,1          Top[51;1H[?12l[?25h[?25l[56;94H49,1-8        Top[52;8H[?12l[?25h[?25l[56;94H50,1-8        Top[54;8H[?12l[?25h[?25l[56;94H51,1-8        Top[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;13H}[56;1H[K[56;94H52,1           1%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;13Hexptime {[56;94H[K[56;94H53,1           2%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mset[m _exptime [[33mlindex[m [36m$tokens[m [31m1[m][56;94H[K[56;94H54,1           4%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17Hputs [31m"[m[30m[43myangx[m[31m3 $sd_ 15 OK Exposure time set to: $_exptime sec."[m[56;94H[K[56;94H55,1-8         5%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H56,1-8         7%[55;8H[?12l[?25h[?25l[56;94H55,1-8         7%[54;8H[?12l[?25h[?25l[56;94H54,1           7%[53;1H[?12l[?25h[?25l[56;94H53,1           7%[52;1H[?12l[?25h[?25l[56;94H52,1           7%[51;1H[?12l[?25h[?25l[56;94H51,1-8         7%[50;8H[?12l[?25h[?25l[56;94H50,1-8         7%[49;8H[?12l[?25h[?25l[56;94H49,1-8         7%[47;8H[?12l[?25h[?25l[56;94H48,1           7%[46;1H[?12l[?25h[?25l[56;94H47,1           7%[44;1H[?12l[?25h[?25l[56;94H46,1           7%[43;1H[?12l[?25h[?25l[56;94H45,0-1         7%[42;1H[?12l[?25h[?25l[56;94H44,1           7%[41;1H[?12l[?25h[?25l[56;94H43,1           7%[40;1H[?12l[?25h[?25l[56;94H42,1           7%[38;1H[?12l[?25h[?25l[56;94H41,1           7%[37;1H[?12l[?25h[?25l[56;94H40,1           7%[35;1H[?12l[?25h[?25l[56;94H39,1           7%[34;1H[?12l[?25h[?25l[56;94H38,1           7%[33;1H[?12l[?25h[?25l[56;94H37,1           7%[32;1H[?12l[?25h[?25l[56;94H36,0-1         7%[31;1H[?12l[?25h[?25l[56;94H35,1           7%[30;1H[?12l[?25h[?25l[56;94H34,1           7%[29;1H[?12l[?25h[?25l[56;94H33,1-8         7%[28;8H[?12l[?25h[?25l[56;94H32,1-8         7%[27;8H[?12l[?25h[?25l[56;94H31,1           7%[26;1H[?12l[?25h[?25l[56;94H30,1           7%[25;1H[?12l[?25h[?25l[56;94H29,1           7%[24;1H[?12l[?25h[?25l[56;94H28,1           7%[23;1H[?12l[?25h[?25l[56;94H27,0-1         7%[22;1H[?12l[?25h[?25l[56;94H26,1           7%[21;1H[?12l[?25h[?25l[56;94H25,1           7%[20;1H[?12l[?25h[?25l[56;94H24,1           7%[19;1H[?12l[?25h[?25l[56;94H23,1           7%[18;1H[?12l[?25h[?25l[56;94H22,1           7%[17;1H[?12l[?25h[?25l[56;94H21,0-1         7%[16;1H[?12l[?25h[?25l[56;94H20,1           7%[15;1H[?12l[?25h[?25l[56;94H19,1-8         7%[14;8H[?12l[?25h[?25l[56;94H18,1-8         7%[13;8H[?12l[?25h[?25l[56;94H17,1           7%[12;1H[?12l[?25h[?25l[56;94H16,1           7%[11;1H[?12l[?25h[?25l[56;94H15,1           7%[10;1H[?12l[?25h[?25l[56;94H14,1           7%[9;1H[?12l[?25h[?25l[56;94H13,1           7%[8;1H[?12l[?25h[?25l[56;94H12,1           7%[7;1H[?12l[?25h[?25l[56;94H11,0-1         7%[6;1H[?12l[?25h[?25l[56;94H10,1           7%[5;1H[?12l[?25h[?25l[56;94H9,1            7%[4;1H[?12l[?25h[?25l[56;94H8,1            7%[3;1H[?12l[?25h[?25l[56;94H7,1            7%[2;1H[?12l[?25h[?25l[56;94H6,1            7%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H5,0-1          5%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[33mnamespace[m [35mimport[m itcl::*[56;94H[K[56;94H4,1            4%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1Hpackage require Itcl[56;94H[K[56;94H3,1            2%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H2,0-1          1%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m#!/usr/bin/tclsh[m[56;94H[K[56;94H1,1           Top[1;1H[?12l[?25h[?25l[56;94H2,0-1         Top[2;1H[?12l[?25h[?25l[56;94H3,1           Top[3;1H[?12l[?25h[?25l[56;94H4,1           Top[4;1H[?12l[?25h[?25l[56;94H5,0-1         Top[5;1H[?12l[?25h[?25l[56;94H6,1           Top[6;1H[?12l[?25h[?25l[56;94H7,1           Top[7;1H[?12l[?25h[?25l[56;94H8,1           Top[8;1H[?12l[?25h[?25l[56;94H9,1           Top[9;1H[?12l[?25h[?25l[56;94H10,1          Top[10;1H[?12l[?25h[?25l[56;94H11,0-1        Top[11;1H[?12l[?25h[?25l[56;94H12,1          Top[12;1H[?12l[?25h[?25l[56;94H13,1          Top[13;1H[?12l[?25h[?25l[56;94H14,1          Top[14;1H[?12l[?25h[?25l[56;94H15,1          Top[15;1H[?12l[?25h[?25l[56;94H16,1          Top[16;1H[?12l[?25h[?25l[56;94H17,1          Top[17;1H[?12l[?25h[?25l[56;94H18,1-8        Top[18;8H[?12l[?25h[?25l[56;94H19,1-8        Top[19;8H[?12l[?25h[?25l[56;94H20,1          Top[20;1H[?12l[?25h[?25l[56;94H21,0-1        Top[21;1H[?12l[?25h[?25l[56;94H22,1          Top[22;1H[?12l[?25h[?25l[56;94H23,1          Top[23;1H[?12l[?25h[?25l[56;94H24,1          Top[24;1H[?12l[?25h[?25l[56;94H25,1          Top[25;1H[?12l[?25h[?25l[56;94H26,1          Top[26;1H[?12l[?25h[?25l[56;94H27,0-1        Top[27;1H[?12l[?25h[?25l[56;94H28,1          Top[28;1H[?12l[?25h[?25l[56;94H29,1          Top[29;1H[?12l[?25h[?25l[56;94H30,1          Top[30;1H[?12l[?25h[?25l[56;94H31,1          Top[31;1H[?12l[?25h[?25l[56;94H32,1-8        Top[32;8H[?12l[?25h[?25l[56;94H33,1-8        Top[33;8H[?12l[?25h[?25l[56;94H34,1          Top[34;1H[?12l[?25h[?25l[56;94H35,1          Top[35;1H[?12l[?25h[?25l[56;94H36,0-1        Top[36;1H[?12l[?25h[?25l[56;94H37,1          Top[37;1H[?12l[?25h[?25l[56;94H38,1          Top[38;1H[?12l[?25h[?25l[56;94H39,1          Top[39;1H[?12l[?25h[?25l[56;94H40,1          Top[40;1H[?12l[?25h[?25l[56;94H41,1          Top[42;1H[?12l[?25h[?25l[56;94H42,1          Top[43;1H[?12l[?25h[?25l[56;94H43,1          Top[45;1H[?12l[?25h[?25l[56;94H44,1          Top[46;1H[?12l[?25h[?25l[56;94H45,0-1        Top[47;1H[?12l[?25h[?25l[56;94H46,1          Top[48;1H[?12l[?25h[?25l[56;94H47,1          Top[49;1H[?12l[?25h[?25l[56;94H48,1          Top[51;1H[?12l[?25h[?25l[56;94H49,1-8        Top[52;8H[?12l[?25h[?25l[56;94H50,1-8        Top[54;8H[?12l[?25h[?25l[56;94H51,1-8        Top[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;13H}[56;94H[K[56;94H52,1           1%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;13Hexptime {[56;94H[K[56;94H53,1           2%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mset[m _exptime [[33mlindex[m [36m$tokens[m [31m1[m][56;94H[K[56;94H54,1           4%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17Hputs [31m"[m[30m[43myangx[m[31m3 $sd_ 15 OK Exposure time set to: $_exptime sec."[m[56;94H[K[56;94H55,1-8         5%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H56,1-8         7%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #the following are the test for why _exptime is not a double[m[56;94H[K[56;94H57,1-8         8%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #It's a strange token output. [m[56;94H[K[56;94H58,1-8        10%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mset[m sp [[33mstring[m [35mrange[m $_exptime [31m0[m [31m5[m][56;94H[K[56;94H59,1-8        11%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H60,1-8        13%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #set value [format %f $_exptime][m[56;94H[K[56;94H61,1-8        14%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mif[m { [[33mstring[m is double $_exptime] } {[56;94H[K[56;94H62,1-8        15%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25Hputs [31m"exptime  is a double"[m[56;94H[K[56;94H63,1-8        17%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H} [33melse[m {[56;94H[K[56;94H64,1          18%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25Hputs [31m"exptime is not a double"[m[56;94H[K[56;94H65,1-8        20%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H}[56;94H[K[56;94H66,1-8        21%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mif[m { [[33mstring[m is double [36m$sp[m] } {[56;94H[K[56;94H67,1-8        23%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25Hputs [31m"sp is a double"[m[56;94H[K[56;94H68,1          24%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H}[56;94H[K[56;94H69,1          26%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H70,0-1        27%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mset[m q [[33mstring[m [35mlength[m $_exptime][56;94H[K[56;94H71,1-8        28%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H72,1-8        30%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17Hputs [31m"the exptime lenghth=$q"[m[56;94H[K[56;94H73,1-8        31%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mfor[m {[33mset[m i [31m0[m} {[36m$i[m < [36m$q[m} {[33mincr[m i} {[56;94H[K[56;94H74,1-8        33%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25H[33mset[m t [[33mstring[m [35mindex[m $_exptime [36m$i[m][56;94H[K[56;94H75,1-8        34%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25Hputs [31m"t=$t"[m[56;94H[K[56;94H76,1-8        36%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25H[33mif[m { [36m$t[m == [31m"."[m } {[56;94H[K[56;94H77,1-8        37%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;33Hputs [31m"the . =$t at index $i"[m[56;94H[K[56;94H78,1-8        39%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25H}[56;94H[K[56;94H79,1-8        40%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H}[56;94H[K[56;94H80,1-8        42%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#               set _exptime $sp[m[56;94H[K[56;94H81,1          43%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #reassign _exptime here because somehow the original _exptime [m[56;94H[K[56;94H82,1-8        44%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #value has extra character with is not a number so some how[m[56;94H[K[56;94H83,1-8        46%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #it dosen't consider as a double vale. Don't know how it happened. [m[56;94H[K[56;94H84,1-8        47%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H85,0-1        49%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #it's ok now. It's fixed. the value is from [m[56;94H[K[56;94H86,1-8        50%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                # the putDet function in the pilatusControl.tcl.[m[56;94H[K[56;94H87,1-8        52%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H88,0-1        53%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17HtoDhs [36m$sd_[m [31m"15 OK Exposure time set to: $_exptime sec."[m[56;94H[K[56;94H89,1          55%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;13H}[56;94H[K[56;94H90,1          56%[55;1H[?12l[?25h[?25l[1;55r[1;1H[2M[1;56r[55;9H}[56;94H[K[56;94H91,0-1        58%[54;1H[?12l[?25h[?25l[56;94H92,1          58%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H93,0-1        60%[55;1H[?12l[?25h[?25l[1;55r[1;1H[2M[1;56r[54;5H}[56;94H[K[56;94H94,1          62%[54;1H[?12l[?25h[?25l[56;94H95,0-1        62%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5Hpublic method sendExposeCompleteResponse {sd_ filename_} {[56;94H[K[56;94H96,1          64%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9HtoDhs [36m$sd_[m [31m"7 OK $filename_"[m[56;94H[K[56;94H97,1          65%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5H}[56;94H[K[56;94H98,1          67%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H99,0-1        68%[55;1H[?12l[?25h[?25l[1;55r[1;1H[2M[1;56r[54;5Hpublic method breakConnection {} {[55;9Hputs [31m"disconnect from dcss"[m[56;94H[K[56;94H100,1         71%[54;1H[?12l[?25h[?25l[56;94H101,1         71%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5H}[56;94H[K[56;94H102,1         72%[55;1H[?12l[?25h[?25l[1;55r[1;1H[2M[1;56r[55;5Hprivate method toDhs { sd_ msg } {[56;94H[K[56;94H103,1         75%[54;1H[?12l[?25h[?25l[56;94H104,1         75%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9Hputs -nonewline [36m$sd_[m [36m$msg[m[56;94H[K[56;94H105,1         76%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#       puts $sd_ $msg[m[56;94H[K[56;94H106,1         78%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9HendLine [36m$sd_[m[56;94H[K[56;94H107,1         80%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5H}[56;94H[K[56;94H108,1         81%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H109,0-1       83%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5Hprivate method endLine {sd_ } {[56;94H[K[56;94H110,1         84%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9Hputs -nonewline [36m$sd_[m [[33mformat[m %c [31m"24"[m][56;94H[K[56;94H111,1         86%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#       puts $sd_ [format %c "24"][m[56;94H[K[56;94H112,1         87%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9Hflush [36m$sd_[m[56;94H[K[56;94H113,1         89%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5H}[56;94H[K[56;94H114,1         90%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H115,0-1       92%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H}[56;94H[K[56;94H116,1         93%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H117,0-1       95%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#MockPilatusServer mockPilatusServer [::config getStr pilatus.port][m[56;94H[K[56;94H118,1         96%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HMockPilatusServer mockPilatusServe [31m41234[m[56;94H[K[56;94H119,1         98%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1Hvwait forever[56;94H[K[56;94H120,1         Bot[55;1H[?12l[?25h[?25l[56;94H119,1         Bot[54;1H[?12l[?25h[?25l[56;94H118,1         Bot[53;1H[?12l[?25h[?25l[56;94H117,0-1       Bot[52;1H[?12l[?25h[?25l[56;94H116,1         Bot[51;1H[?12l[?25h[?25l[56;94H115,0-1       Bot[50;1H[?12l[?25h[?25l[56;94H114,1         Bot[49;1H[?12l[?25h[?25l[56;94H113,1         Bot[48;1H[?12l[?25h[?25l[56;94H112,1         Bot[47;1H[?12l[?25h[?25l[56;94H111,1         Bot[46;1H[?12l[?25h[?25l[56;94H110,1         Bot[45;1H[?12l[?25h[?25l[56;94H109,0-1       Bot[44;1H[?12l[?25h[?25l[56;94H108,1         Bot[43;1H[?12l[?25h[?25l[56;94H107,1         Bot[42;1H[?12l[?25h[?25l[56;94H106,1         Bot[41;1H[?12l[?25h[?25l[56;94H105,1         Bot[40;1H[?12l[?25h[?25l[56;94H104,1         Bot[39;1H[?12l[?25h[?25l[56;94H103,1         Bot[38;1H[?12l[?25h[?25l[56;94H102,1         Bot[37;1H[?12l[?25h[?25l[56;94H101,1         Bot[36;1H[?12l[?25h[?25l[56;94H100,1         Bot[35;1H[?12l[?25h[?25l[56;94H99,0-1        Bot[34;1H[?12l[?25h[?25l[56;94H98,1          Bot[33;1H[?12l[?25h[?25l[56;94H97,1          Bot[32;1H[?12l[?25h[?25l[56;94H96,1          Bot[31;1H[?12l[?25h[?25l[56;94H95,0-1        Bot[30;1H[?12l[?25h[?25l[56;94H94,1          Bot[29;1H[?12l[?25h[?25l[56;94H93,0-1        Bot[28;1H[?12l[?25h[?25l[56;94H92,1          Bot[27;1H[?12l[?25h[?25l[56;94H91,0-1        Bot[26;1H[?12l[?25h[?25l[56;94H90,1          Bot[25;1H[?12l[?25h[?25l[56;94H89,1          Bot[24;1H[?12l[?25h[?25l[56;94H88,0-1        Bot[23;1H[?12l[?25h[?25l[56;94H87,1-8        Bot[22;8H[?12l[?25h[?25l[56;94H86,1-8        Bot[21;8H[?12l[?25h[?25l[56;94H85,0-1        Bot[20;1H[?12l[?25h[?25l[56;94H84,1-8        Bot[19;8H[?12l[?25h[?25l[56;94H83,1-8        Bot[18;8H[?12l[?25h[?25l[56;94H82,1-8        Bot[17;8H[?12l[?25h[?25l[56;94H81,1          Bot[16;1H[?12l[?25h[?25l[56;94H80,1-8        Bot[15;8H[?12l[?25h[?25l[56;94H79,1-8        Bot[14;8H[?12l[?25h[?25l[56;94H78,1-8        Bot[13;8H[?12l[?25h[?25l[56;94H77,1-8        Bot[12;8H[?12l[?25h[?25l[56;94H76,1-8        Bot[11;8H[?12l[?25h[?25l[56;94H75,1-8        Bot[10;8H[?12l[?25h[?25l[56;94H74,1-8        Bot[9;8H[?12l[?25h[?25l[56;94H73,1-8        Bot[8;8H[?12l[?25h[?25l[56;94H72,1-8        Bot[7;8H[?12l[?25h[?25l[56;94H71,1-8        Bot[6;8H[?12l[?25h[?25l[56;94H70,0-1        Bot[5;1H[?12l[?25h[?25l[56;94H69,1          Bot[4;1H[?12l[?25h[?25l[56;94H68,1          Bot[3;1H[?12l[?25h[?25l[56;94H67,1-8        Bot[2;8H[?12l[?25h[?25l[56;94H66,1-8        Bot[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;25Hputs [31m"exptime is not a double"[m[56;94H[K[56;94H65,1-8        98%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17H} [33melse[m {[56;94H[K[56;94H64,1          96%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;25Hputs [31m"exptime  is a double"[m[56;94H[K[56;94H63,1-8        95%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17H[33mif[m { [[33mstring[m is double $_exptime] } {[56;94H[K[56;94H62,1-8        93%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m                #set value [format %f $_exptime][m[56;94H[K[56;94H61,1-8        92%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H60,1-8        90%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17H[33mset[m sp [[33mstring[m [35mrange[m $_exptime [31m0[m [31m5[m][56;94H[K[56;94H59,1-8        89%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m                #It's a strange token output. [m[56;94H[K[56;94H58,1-8        87%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m                #the following are the test for why _exptime is not a double[m[56;94H[K[56;94H57,1-8        86%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H56,1-8        84%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17Hputs [31m"[m[30m[43myangx[m[31m3 $sd_ 15 OK Exposure time set to: $_exptime sec."[m[56;94H[K[56;94H55,1-8        83%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17H[33mset[m _exptime [[33mlindex[m [36m$tokens[m [31m1[m][56;94H[K[56;94H54,1          81%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;13Hexptime {[56;94H[K[56;94H53,1          80%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;13H}[56;94H[K[56;94H52,1          78%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m                #::itcl::code $this sendExposeCompleteResponse $sd_ $_filename[m[56;94H[K[56;94H51,1-8        76%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m                #after [expr $_exptime * 1000][m[56;94H[K[56;94H50,1-8        75%[1;8H[?12l[?25h[?25l[1;55r[1;1H[2L[1;56r[1;17Hafter  [[33mexpr[m {int($_exptime*[31m1000[m)}] [::itcl::code [36m$this[m sendExposeCompleteResponse [36m$sd_[m [31m"/home//[m[2;1H[30m[43myangx[m[31m/ptest1"[m][56;94H[K[56;94H49,1-8        72%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17HtoDhs [36m$sd_[m [31m"15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:43:49.748"[m[56;94H[K[56;94H48,1          71%[1;1H[?12l[?25h[?25l[1;55r[1;1H[2L[1;56r[1;1H[34m#ori-yang       toDhs $sd_ "15 OK Exposure time set to: $_exptime sec.15 OK Starting externally triggered exposs[2;1Hure(s): 2009/Jul/10 10:43:49.748"[m[56;94H[K[56;94H47,1          68%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17H[33mset[m filename [[33mlindex[m [36m$tokens[m [31m1[m][56;94H[K[56;94H46,1          67%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H45,0-1        65%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17H}[56;94H[K[56;94H44,1          64%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;21H[33mreturn[m[56;94H[K[56;94H43,1          62%[1;1H[?12l[?25h[?25l[1;55r[1;1H[2L[1;56r[1;21Hafter [[33mexpr[m $_expTime * [31m1000[m] [::itcl::code [36m$this[m sendExposeCompleteResponse [36m$sd_[m $_filenamm[2;1He][56;94H[K[56;94H42,1          60%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;21HtoDhs [36m$sd_[m [31m"15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:36:22.2837 ERR"[m[56;94H[K[56;94H41,1          58%[1;1H[?12l[?25h[?25l[1;55r[1;1H[2L[1;56r[1;21Hputs [31m"[m[30m[43myangx[m[31m1 $sd_ 15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:36:22.2833[2;1H7 ERR"[m[56;94H[K[56;94H40,1          56%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;17H[33mif[m {$_exptime==[31m""[m} {[56;94H[K[56;94H39,1          55%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;13Hexttrigger {[56;94H[K[56;94H38,1          53%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9H[33mswitch[m [[33mlindex[m [36m$tokens[m [31m0[m] {[56;94H[K[56;94H37,1          52%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H36,0-1        50%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9H[33mset[m tokens [split [36m$data[m][56;94H[K[56;94H35,1          49%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9Hputs [31m"PILATUS<DHS-YANG: $data $i"[m[56;94H[K[56;94H34,1          47%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9H[33mset[m i  [[33mexpr[m [36m$i[m + [31m1[m][56;94H[K[56;94H33,1-8        46%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9H[33mglobal[m i[56;94H[K[56;94H32,1-8        44%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9H}[56;94H[K[56;94H31,1          43%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;13H[33mreturn[m[56;94H[K[56;94H30,1          42%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9H[33mif[m {[catch {gets [36m$sd_[m data} rc]} {[56;94H[K[56;94H29,1          40%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;5Hpublic method handleClientInput { sd_ } {[56;94H[K[56;94H28,1          39%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H27,0-1        37%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;4H}[56;94H[K[56;94H26,1          36%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;7Hfileevent [36m$sd_[m readable [::itcl::code [36m$this[m handleClientInput [36m$sd_[m][56;94H[K[56;94H25,1          34%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;7Hfconfigure [36m$sd_[m -buffering line[56;94H[K[56;94H24,1          33%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;7Hputs [31m"MOCK PILATUS HANDLE CONNECT $sd_"[m[56;94H[K[56;94H23,1          31%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;4Hpublic method accept {sd_ address_ port_} {[56;94H[K[56;94H22,1          30%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H21,0-1        28%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;4H}[56;94H[K[56;94H20,1          27%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9Hputs [31m"MockPilatusServer is establed"[m[56;94H[K[56;94H19,1-8        26%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;9H}[56;94H[K[56;94H18,1-8        24%[1;8H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;10H[33mreturn[m -code error[56;94H[K[56;94H17,1          23%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;10Hputs [31m"ERROR Could not create mock server socket for Pilatus: $_socket"[m[56;94H[K[56;94H16,1          21%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;7H} _socket]} {[56;94H[K[56;94H15,1          20%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;10Hsocket -server [::itcl::code [36m$this[m accept] [36m$port_[m[56;94H[K[56;94H14,1          18%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;7H[33mif[m {[catch {[56;94H[K[56;94H13,1          17%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;4Hconstructor {port_} {[56;94H[K[56;94H12,1          15%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H11,0-1        14%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;5Hpublic [33mvariable[m _exptime [31m""[m[56;94H[K[56;94H10,1          13%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m    #private variable _exptime ""[m[56;94H[K[56;94H9,1           11%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;5Hprivate [33mvariable[m _socket[56;94H[K[56;94H8,1           10%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1Hclass MockPilatusServer {[56;94H[K[56;94H7,1            8%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[33mset[m i [31m0[m[56;94H[K[56;94H6,1            7%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H5,0-1          5%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[33mnamespace[m [35mimport[m itcl::*[56;94H[K[56;94H4,1            4%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1Hpackage require Itcl[56;94H[K[56;94H3,1            2%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H2,0-1          1%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m#!/usr/bin/tclsh[m[56;94H[K[56;94H1,1           Top[1;1H[?12l[?25h[?25l[56;94H2,0-1         Top[2;1H[?12l[?25h[?25l[56;94H3,1           Top[3;1H[?12l[?25h[?25l[56;94H4,1           Top[4;1H[?12l[?25h[?25l[56;94H5,0-1         Top[5;1H[?12l[?25h[?25l[56;94H6,1           Top[6;1H[?12l[?25h[?25l[56;94H7,1           Top[7;1H[?12l[?25h[?25l[56;94H8,1           Top[8;1H[?12l[?25h[?25l[56;94H9,1           Top[9;1H[?12l[?25h[?25l[56;94H10,1          Top[10;1H[?12l[?25h[?25l[56;94H11,0-1        Top[11;1H[?12l[?25h[?25l[56;94H12,1          Top[12;1H[?12l[?25h[?25l[56;94H13,1          Top[13;1H[?12l[?25h[?25l[56;94H14,1          Top[14;1H[?12l[?25h[?25l[56;94H13,1          Top[13;1H[?12l[?25h[?25l[56;94H12,1          Top[12;1H[?12l[?25h[?25l[56;94H12,2          Top[12;2H[?12l[?25h[?25l[56;94H12,3          Top[12;3H[?12l[?25h[?25l[56;94H12,4          Top[12;4H[?12l[?25h[?25l[56;94H13,4          Top[13;4H[?12l[?25h[?25l[56;94H14,4          Top[14;4H[?12l[?25h[?25l[56;94H15,4          Top[15;4H[?12l[?25h[?25l[56;94H16,4          Top[16;4H[?12l[?25h[?25l[56;94H17,4          Top[17;4H[?12l[?25h[?25l[56;94H18,1-8        Top[18;8H[?12l[?25h[?25l[56;94H19,1-8        Top[19;8H[?12l[?25h[?25l[12;24H[46m{[20;4H}[m[56;94H20,4          Top[20;4H[?12l[?25h[?25l[12;24H{[20;4H}[56;94H21,0-1        Top[21;1H[?12l[?25h[?25l[56;94H22,4          Top[22;4H[?12l[?25h[?25l[56;94H23,4          Top[23;4H[?12l[?25h[?25l[56;94H24,4          Top[24;4H[?12l[?25h[?25l[56;94H25,4          Top[25;4H[?12l[?25h[?25l[22;46H[46m{[26;4H}[m[56;94H26,4          Top[26;4H[?12l[?25h[?25l[22;46H{[26;4H}[56;94H27,0-1        Top[27;1H[?12l[?25h[?25l[56;94H28,4          Top[28;4H[?12l[?25h[?25l[56;94H29,4          Top[29;4H[?12l[?25h[?25l[56;94H30,4          Top[30;4H[?12l[?25h[?25l[56;94H31,4          Top[31;4H[?12l[?25h[?25l[56;94H32,1-8        Top[32;8H[?12l[?25h[?25l[56;94H33,1-8        Top[33;8H[?12l[?25h[?25l[56;94H34,4          Top[34;4H[?12l[?25h[?25l[56;94H35,4          Top[35;4H[?12l[?25h[?25l[56;94H36,0-1        Top[36;1H[?12l[?25h[?25l[56;94H37,4          Top[37;4H[?12l[?25h[?25l[56;94H38,4          Top[38;4H[?12l[?25h[?25l[56;94H39,4          Top[39;4H[?12l[?25h[?25l[56;94H40,4          Top[40;4H[?12l[?25h[?25l[56;94H41,4          Top[42;4H[?12l[?25h[?25l[56;94H42,4          Top[43;4H[?12l[?25h[?25l[56;94H43,4          Top[45;4H[?12l[?25h[?25l[56;94H44,4          Top[46;4H[?12l[?25h[?25l[56;94H45,0-1        Top[47;1H[?12l[?25h[?25l[56;94H46,4          Top[48;4H[?12l[?25h[?25l[56;94H47,4          Top[49;4H[?12l[?25h[?25l[56;94H48,4          Top[51;4H[?12l[?25h[?25l[56;94H49,1-8        Top[52;8H[?12l[?25h[?25l[56;94H50,1-8        Top[54;8H[?12l[?25h[?25l[56;94H51,1-8        Top[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;13H}[56;94H[K[56;94H52,4           1%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;13Hexptime {[56;94H[K[56;94H53,4           2%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mset[m _exptime [[33mlindex[m [36m$tokens[m [31m1[m][56;94H[K[56;94H54,4           4%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17Hputs [31m"[m[30m[43myangx[m[31m3 $sd_ 15 OK Exposure time set to: $_exptime sec."[m[56;94H[K[56;94H55,1-8         5%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H56,1-8         7%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #the following are the test for why _exptime is not a double[m[56;94H[K[56;94H57,1-8         8%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #It's a strange token output. [m[56;94H[K[56;94H58,1-8        10%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mset[m sp [[33mstring[m [35mrange[m $_exptime [31m0[m [31m5[m][56;94H[K[56;94H59,1-8        11%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H60,1-8        13%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #set value [format %f $_exptime][m[56;94H[K[56;94H61,1-8        14%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mif[m { [[33mstring[m is double $_exptime] } {[56;94H[K[56;94H62,1-8        15%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25Hputs [31m"exptime  is a double"[m[56;94H[K[56;94H63,1-8        17%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H} [33melse[m {[56;94H[K[56;94H64,2-8        18%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25Hputs [31m"exptime is not a double"[m[56;94H[K[56;94H65,1-8        20%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H}[56;94H[K[56;94H66,1-8        21%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mif[m { [[33mstring[m is double [36m$sp[m] } {[56;94H[K[56;94H67,1-8        23%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25Hputs [31m"sp is a double"[m[56;94H[K[56;94H68,4          24%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H}[56;94H[K[56;94H69,4          26%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H70,0-1        27%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mset[m q [[33mstring[m [35mlength[m $_exptime][56;94H[K[56;94H71,1-8        28%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H72,1-8        30%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17Hputs [31m"the exptime lenghth=$q"[m[56;94H[K[56;94H73,1-8        31%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H[33mfor[m {[33mset[m i [31m0[m} {[36m$i[m < [36m$q[m} {[33mincr[m i} {[56;94H[K[56;94H74,1-8        33%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25H[33mset[m t [[33mstring[m [35mindex[m $_exptime [36m$i[m][56;94H[K[56;94H75,1-8        34%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25Hputs [31m"t=$t"[m[56;94H[K[56;94H76,1-8        36%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25H[33mif[m { [36m$t[m == [31m"."[m } {[56;94H[K[56;94H77,1-8        37%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;33Hputs [31m"the . =$t at index $i"[m[56;94H[K[56;94H78,1-8        39%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;25H}[56;94H[K[56;94H79,1-8        40%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17H}[56;94H[K[56;94H80,1-8        42%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#               set _exptime $sp[m[56;94H[K[56;94H81,2-8        43%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #reassign _exptime here because somehow the original _exptime [m[56;94H[K[56;94H82,1-8        44%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #value has extra character with is not a number so some how[m[56;94H[K[56;94H83,1-8        46%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #it dosen't consider as a double vale. Don't know how it happened. [m[56;94H[K[56;94H84,1-8        47%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H85,0-1        49%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                #it's ok now. It's fixed. the value is from [m[56;94H[K[56;94H86,1-8        50%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m                # the putDet function in the pilatusControl.tcl.[m[56;94H[K[56;94H87,1-8        52%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H88,0-1        53%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;17HtoDhs [36m$sd_[m [31m"15 OK Exposure time set to: $_exptime sec."[m[56;94H[K[56;94H89,4          55%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;13H}[56;94H[K[56;94H90,4          56%[55;4H[?12l[?25h[?25l[1;55r[1;1H[2M[1;56r[55;9H}[56;94H[K[56;94H91,0-1        58%[54;1H[?12l[?25h[?25l[56;94H92,4          58%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H93,0-1        60%[55;1H[?12l[?25h[?25l[1;55r[1;1H[2M[1;56r[54;5H}[56;94H[K[56;94H94,4          62%[54;4H[?12l[?25h[?25l[56;94H95,0-1        62%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5Hpublic method sendExposeCompleteResponse {sd_ filename_} {[56;94H[K[56;94H96,4          64%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9HtoDhs [36m$sd_[m [31m"7 OK $filename_"[m[56;94H[K[56;94H97,4          65%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5H}[56;94H[K[56;94H98,4          67%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H99,0-1        68%[55;1H[?12l[?25h[?25l[1;55r[1;1H[2M[1;56r[54;5Hpublic method breakConnection {} {[55;9Hputs [31m"disconnect from dcss"[m[56;94H[K[56;94H100,4         71%[54;4H[?12l[?25h[?25l[56;94H101,4         71%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5H}[56;94H[K[56;94H102,4         72%[55;4H[?12l[?25h[?25l[1;55r[1;1H[2M[1;56r[55;5Hprivate method toDhs { sd_ msg } {[56;94H[K[56;94H103,4         75%[54;4H[?12l[?25h[?25l[56;94H104,4         75%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9Hputs -nonewline [36m$sd_[m [36m$msg[m[56;94H[K[56;94H105,4         76%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#       puts $sd_ $msg[m[56;94H[K[56;94H106,2-8       78%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9HendLine [36m$sd_[m[56;94H[K[56;94H107,4         80%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5H}[56;94H[K[56;94H108,4         81%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H109,0-1       83%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5Hprivate method endLine {sd_ } {[56;94H[K[56;94H110,4         84%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9Hputs -nonewline [36m$sd_[m [[33mformat[m %c [31m"24"[m][56;94H[K[56;94H111,4         86%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#       puts $sd_ [format %c "24"][m[56;94H[K[56;94H112,2-8       87%[55;8H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;9Hflush [36m$sd_[m[56;94H[K[56;94H113,4         89%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;5H}[56;94H[K[56;94H114,4         90%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H115,0-1       92%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H}[56;94H[K[56;94H116,1         93%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[56;94H[K[56;94H117,0-1       95%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#MockPilatusServer mockPilatusServer [::config getStr pilatus.port][m[56;94H[K[56;94H118,4         96%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HMockPilatusServer mockPilatusServe [31m41234[m[56;94H[K[56;94H119,4         98%[55;4H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1Hvwait forever[56;94H[K[56;94H120,4         Bot[55;4H[?12l[?25h[?25l[56;94H119,4         Bot[54;4H[?12l[?25h[?25l[56;94H118,4         Bot[53;4H[?12l[?25h[?25l[56;94H117,0-1       Bot[52;1H[?12l[?25h[?25l[56;94H116,1         Bot[51;1H[?12l[?25h[?25l[56;94H115,0-1       Bot[50;1H[?12l[?25h[?25l[56;94H114,4         Bot[49;4H[?12l[?25h[?25l[56;94H113,4         Bot[48;4H[?12l[?25h[?25l[56;94H112,2-8       Bot[47;8H[?12l[?25h[?25l[56;94H111,4         Bot[46;4H[?12l[?25h[?25l[56;94H110,4         Bot[45;4H[?12l[?25h[?25l[56;94H109,0-1       Bot[44;1H[?12l[?25h[?25l[56;94H108,4         Bot[43;4H[?12l[?25h[?25l[56;94H107,4         Bot[42;4H[?12l[?25h[?25l[56;94H106,2-8       Bot[41;8H[?12l[?25h[?25l[27m[m[H[2J[1;10H[33mreturn[m -code error[2;9H}[3;9Hputs [31m"MockPilatusServer is establed"[m
   }[6;4Hpublic method accept {sd_ address_ port_} {[7;7Hputs [31m"MOCK PILATUS HANDLE CONNECT $sd_"[m[8;7Hfconfigure [36m$sd_[m -buffering line[9;7Hfileevent [36m$sd_[m readable [::itcl::code [36m$this[m handleClientInput [36m$sd_[m]
   }[12;5Hpublic method handleClientInput { sd_ } {[13;9H[33mif[m {[catch {gets [36m$sd_[m data} rc]} {[14;13H[33mreturn[m[15;9H}[16;9H[33mglobal[m i[17;9H[33mset[m i  [[33mexpr[m [36m$i[m + [31m1[m][18;9Hputs [31m"PILATUS<DHS-YANG: $data $i"[m[19;9H[33mset[m tokens [split [36m$data[m][21;9H[33mswitch[m [[33mlindex[m [36m$tokens[m [31m0[m] {[22;13Hexttrigger {[23;17H[33mif[m {$_exptime==[31m""[m} {[24;21Hputs [31m"[m[30m[43myangx[m[31m1 $sd_ 15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:36:22.2833[25;1H7 ERR"[m[26;21HtoDhs [36m$sd_[m [31m"15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:36:22.2837 ERR"[m[27;21Hafter [[33mexpr[m $_expTime * [31m1000[m] [::itcl::code [36m$this[m sendExposeCompleteResponse [36m$sd_[m $_filenamm[28;1He][29;21H[33mreturn[m[30;17H}[32;17H[33mset[m filename [[33mlindex[m [36m$tokens[m [31m1[m]
[34m#ori-yang       toDhs $sd_ "15 OK Exposure time set to: $_exptime sec.15 OK Starting externally triggered exposs[34;1Hure(s): 2009/Jul/10 10:43:49.748"[m[35;17HtoDhs [36m$sd_[m [31m"15 OK Starting externally triggered exposure(s): 2009/Jul/10 10:43:49.748"[m[36;17Hafter  [[33mexpr[m {int($_exptime*[31m1000[m)}] [::itcl::code [36m$this[m sendExposeCompleteResponse [36m$sd_[m [31m"/home//[m[37;1H[30m[43myangx[m[31m/ptest1"[m]
[34m                #after [expr $_exptime * 1000]
                #::itcl::code $this sendExposeCompleteResponse $sd_ $_filename[m[40;13H}[41;13Hexptime {[42;17H[33mset[m _exptime [[33mlindex[m [36m$tokens[m [31m1[m][43;17Hputs [31m"[m[30m[43myangx[m[31m3 $sd_ 15 OK Exposure time set to: $_exptime sec."[m

[34m                #the following are the test for why _exptime is not a double
                #It's a strange token output. [m[47;17H[33mset[m sp [[33mstring[m [35mrange[m $_exptime [31m0[m [31m5[m]

[34m                #set value [format %f $_exptime][m[50;17H[33mif[m { [[33mstring[m is double $_exptime] } {[51;25Hputs [31m"exptime  is a double"[m[52;17H} [33melse[m {[53;25Hputs [31m"exptime is not a double"[m[54;17H}[55;17H[33mif[m { [[33mstring[m is double [36m$sp[m] } {[56;94H67,3-17       23%[55;17H[?12l[?25h[?25l[52;24H[46m{[54;17H}[m[56;94H66,3-17       23%[54;17H[?12l[?25h[?25l[52;24H{[54;17H}[56;94H65,3-24       23%[53;24H[?12l[?25h[?25l[50;53H[46m{[52;17H}[m[56;94H64,4-17       23%[52;17H[?12l[?25h[?25l[50;53H{[52;17H}[56;94H63,3-24       23%[51;24H[?12l[?25h[?25l[56;94H62,3-17       23%[50;17H[?12l[?25h[?25l[56;94H61,3-17       23%[49;17H[?12l[?25h[?25l[56;94H60,2-16       23%[48;16H[?12l[?25h[?25l[56;94H59,3-17       23%[47;17H[?12l[?25h[?25l[56;94H58,3-17       23%[46;17H[?12l[?25h[?25l[56;94H57,3-17       23%[45;17H[?12l[?25h[?25l[56;94H56,2-16       23%[44;16H[?12l[?25h[?25l[56;94H55,3-17       23%[43;17H[?12l[?25h[?25l[56;94H54,17         23%[42;17H[?12l[?25h[?25l[56;94H53,17         23%[41;17H[?12l[?25h[?25l[22;24H[46m{[40;13H}[m[56;94H52,13         23%[40;13H[?12l[?25h[?25l[22;24H{[40;13H}[56;94H51,3-17       23%[39;17H[?12l[?25h[?25l[56;94H50,3-17       23%[38;17H[?12l[?25h[?25l[56;94H49,3-17       23%[36;17H[?12l[?25h[?25l[56;94H48,17         23%[35;17H[?12l[?25h[?25l[56;94H47,17         23%[33;17H[?12l[?25h[?25l[56;94H46,17         23%[32;17H[?12l[?25h[?25l[56;94H45,0-1        23%[31;1H[?12l[?25h[?25l[23;36H[46m{[30;17H}[m[56;94H44,17         23%[30;17H[?12l[?25h[?25l[23;36H{[30;17H}[56;94H43,17         23%[29;17H[?12l[?25h[?25l[56;94H42,17         23%[27;17H[?12l[?25h[?25l[56;94H41,17         23%[26;17H[?12l[?25h[?25l[56;94H40,7-17       23%[24;17H[?12l[?25h[?25l[56;94H39,17         23%[23;17H[?12l[?25h[?25l[56;94H38,17         23%[22;17H[?12l[?25h[?25l[56;94H37,17         23%[21;17H[?12l[?25h[?25l[56;94H36,0-1        23%[20;1H[?12l[?25h[?25l[56;94H35,17         23%[19;17H[?12l[?25h[?25l[56;94H34,17         23%[18;17H[?12l[?25h[?25l[56;94H33,10-17      23%[17;17H[?12l[?25h[?25l[56;94H32,9-16       23%[16;16H[?12l[?25h[?25l[13;42H[46m{[15;9H}[m[56;94H31,9          23%[15;9H[?12l[?25h[?25l[13;42H{[15;9H}[56;94H30,17         23%[14;17H[?12l[?25h[?25l[56;94H29,17         23%[13;17H[?12l[?25h[?25l[56;94H28,17         23%[12;17H[?12l[?25h[?25l[56;94H27,0-1        23%[11;1H[?12l[?25h[?25l[6;46H[46m{[10;4H}[m[56;94H26,4          23%[10;4H[?12l[?25h[?25l[6;46H{[10;4H}[56;94H25,17         23%[9;17H[?12l[?25h[?25l[56;94H24,17         23%[8;17H[?12l[?25h[?25l[56;94H23,17         23%[7;17H[?12l[?25h[?25l[56;94H22,17         23%[6;17H[?12l[?25h[?25l[56;94H21,0-1        23%[5;1H[?12l[?25h[?25l[56;94H20,5          23%[4;5H[?12l[?25h[?25l[56;94H19,10-17      23%[3;17H[?12l[?25h[?25l[56;94H18,2-9        23%[2;9H[?12l[?25h[?25l[56;94H17,17         23%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;10Hputs [31m"ERROR Could not create mock server socket for Pilatus: $_socket"[m[56;94H[K[56;94H16,17         21%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;7H} _socket]} {[56;94H[K[56;94H15,17         20%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;10Hsocket -server [::itcl::code [36m$this[m accept] [36m$port_[m[56;94H[K[56;94H14,17         18%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;7H[33mif[m {[catch {[56;94H[K[56;94H13,17         17%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;4Hconstructor {port_} {[56;94H[K[56;94H12,17         15%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H11,0-1        14%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;5Hpublic [33mvariable[m _exptime [31m""[m[56;94H[K[56;94H10,17         13%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m    #private variable _exptime ""[m[56;94H[K[56;94H9,17          11%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;5Hprivate [33mvariable[m _socket[56;94H[K[56;94H8,17          10%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1Hclass MockPilatusServer {[56;94H[K[56;94H7,17           8%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[33mset[m i [31m0[m[56;94H[K[56;94H6,7            7%[1;7H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H5,0-1          5%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[33mnamespace[m [35mimport[m itcl::*[56;94H[K[56;94H4,17           4%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1Hpackage require Itcl[56;94H[K[56;94H3,17           2%[1;17H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[56;94H[K[56;94H2,0-1          1%[1;1H[?12l[?25h[?25l[1;55r[1;1H[L[1;56r[1;1H[34m#!/usr/bin/tclsh[m[56;94H[K[56;94H1,16          Top[1;16H[?12l[?25h[?25l[56;94H2,0-1         Top[2;1H[?12l[?25h[?25l[56;94H3,17          Top[3;17H[?12l[?25h[?25l[56;94H4,17          Top[4;17H[?12l[?25h[?25l[56;94H5,0-1         Top[5;1H[?12l[?25h[?25l[56;94H6,7           Top[6;7H[?12l[?25h[?25l[56;94H7,17          Top[7;17H[?12l[?25h[?25l[56;94H8,17          Top[8;17H[?12l[?25h[?25l[56;94H9,17          Top[9;17H[?12l[?25h[?25l[56;94H10,17         Top[10;17H[?12l[?25h[?25l[56;94H11,0-1        Top[11;1H[?12l[?25h[?25l[56;94H12,17         Top[12;17H[?12l[?25h[?25l[56;94H13,17         Top[13;17H[?12l[?25h[?25l[56;94H14,17         Top[14;17H[?12l[?25h[?25l[13;10H[46m{[15;17H}[m[56;94H15,17         Top[15;17H[?12l[?25h[?25l[13;10H{[15;17H}[56;94H16,17         Top[16;17H[?12l[?25h[?25l[56;94H17,17         Top[17;17H[?12l[?25h[?25l[15;19H[46m{[18;9H}[m[56;94H18,2-9        Top[18;9H[?12l[?25h[?25l[15;19H{[18;9H}[56;94H19,10-17      Top[19;17H[?12l[?25h[?25l[56;94H20,5          Top[20;5H[?12l[?25h[?25l[56;94H21,0-1        Top[21;1H[?12l[?25h[?25l[56;94H22,17         Top[22;17H[?12l[?25h[?25l[56;94H22,16         Top[22;16H[?12l[?25h[?25l[56;94H22,15         Top[22;15H[?12l[?25h[?25l[56;94H22,14         Top[22;14H[?12l[?25h[?25l[56;94H22,13         Top[22;13H[?12l[?25h[?25l[56;94H22,12         Top[22;12H[?12l[?25h[?25l[56;94H22,11         Top[22;11H[?12l[?25h[?25l[56;94H22,10         Top[22;10H[?12l[?25h[?25l[56;94H22,9          Top[22;9H[?12l[?25h[?25l[56;94H22,8          Top[22;8H[?12l[?25h[?25l[56;94H22,7          Top[22;7H[?12l[?25h[?25l[56;94H22,6          Top[22;6H[?12l[?25h[?25l[56;94H22,5          Top[22;5H[?12l[?25h[?25l[56;94H22,4          Top[22;4H[?12l[?25h[?25l[56;94H22,3          Top[22;3H[?12l[?25h[?25l[56;94H22,4          Top[22;4H[?12l[?25h[?25l[56;94H23,4          Top[23;4H[?12l[?25h[?25l[56;94H24,4          Top[24;4H[?12l[?25h[?25l[56;94H25,4          Top[25;4H[?12l[?25h[?25l[22;46H[46m{[26;4H}[m[56;94H26,4          Top[26;4H[?12l[?25h[?25l[22;46H{[26;4H}[56;94H27,0-1        Top[27;1H[?12l[?25h[?25l[56;94H28,4          Top[28;4H[?12l[?25h[?25lpublic method handleClientInput { sd_ } {[28;45H[K[28;4H[?12l[?25h[?25l[56;1HType  :quit<Enter>  to exit Vim[56;94H[K[56;94H28,4          Top[28;4H[?12l[?25h[?25l[56;1H[K[56;1H:[?12l[?25hq[?25l:q[?12l[?25h[?25l[1m[37m[41mE37: No write since last change (add ! to override)[m[42C28,4          Top[28;4H[?12l[?25h[?25l[56;1H[K[56;1H:[?12l[?25hq[?25l:q[?12l[?25h![?25l:q![?12l[?25h[?25l[56;1H[K[56;1H[?1l>[?12l[?25h[?1049l[yangx@yangx tests]$ cd ..
[yangx@yangx scripts]$ cd ..
[yangx@yangx pilatusDhs]$ cd ..
[yangx@yangx ~/release-5_1]$ cd diffimage/
[yangx@yangx diffimage]$ cd scri[K[K[K[K[K[Kll
[00mtotal 60
drwxr-xr-x 2 yangx yangx  4096 Mar 26  2012 [00;34mCVS[00m
drwxr-xr-x 3 yangx yangx  4096 Oct 15  2010 [00;34mdecunix[00m
drwxr-xr-x 3 yangx yangx  4096 Oct 15  2010 [00;34mirix[00m
-rw-r--r-- 1 yangx yangx    71 Oct 15  2010 [00mlibtbx_config[00m
drwxr-xr-x 3 yangx yangx  4096 Mar 26  2012 [00;34mlinux[00m
-rwxrwxr-x 1 yangx yangx 16998 Mar 26  2012 [00;32mmakefile[00m
-rw-r--r-- 1 yangx yangx  2794 Oct 15  2010 [00mreadme.txt[00m
-rwxr-xr-x 1 yangx yangx  1219 Oct 15  2010 [00;32mruntest1.csh[00m
-rwxr-xr-x 1 yangx yangx  1328 Oct 15  2010 [00;32mruntest2.csh[00m
-rw-r--r-- 1 yangx yangx  3635 Oct 15  2010 [00mSConscript[00m
drwxr-xr-x 4 yangx yangx  4096 Mar 26  2012 [00;34msrc[00m
[m[yangx@yangx diffimage]$ cd [K[Kcd ..
[yangx@yangx ~/release-5_1]$ cd dd[K[Kdiffra[K[K[K[K[K[Kmicrodiffractometer/
[yangx@yangx microdiffractometer]$ ll
[00mtotal 44
drwxrwxr-x 3 yangx yangx  4096 Nov 14 15:11 [00;34mgalil_scripts[00m
drwxrwxr-x 2 yangx yangx  4096 Jul 17 16:28 [00;34mlinux[00m
drwxrwxr-x 3 yangx yangx  4096 Jun 12 16:04 [00;34mlinux64[00m
-rw-rw-r-- 1 yangx yangx 21147 Jun 12 16:04 [00mmakefile[00m
drwxrwxr-x 3 yangx yangx  4096 Oct 10 15:16 [00;34msrc[00m
drwxrwxr-x 3 yangx yangx  4096 Jun 12 16:04 [00;34mwin32[00m
[m[yangx@yangx microdiffractometer]$ cd galil_scripts/
[yangx@yangx galil_scripts]$ ll
[00mtotal 52
-rw-rw-r-- 1 yangx yangx 1987 Jun 12 16:04 [00mBL12-2galil9.txt[00m
-rw-rw-r-- 1 yangx yangx 2751 Jun 12 16:04 [00mhuber.txt[00m
-rw-rw-r-- 1 yangx yangx 3946 Oct 11 11:28 [00mmicroDiffractometer-step.txt[00m
-rw-rw-r-- 1 yangx yangx 3876 Aug 23 15:20 [00mmicroDiffractometer-test.txt[00m
-rw-rw-r-- 1 yangx yangx 3876 Jul 19 10:28 [00mmicroDiffractometer.txt[00m
-rw-rw-r-- 1 yangx yangx 1987 Jun 12 16:04 [00mscript_05jul00.txt[00m
-rwxrwxr-x 1 yangx yangx  463 Jun 12 16:04 [00;32mscript3.txt[00m
-rw-rw-r-- 1 yangx yangx 2032 Jun 12 16:04 [00mscript4_8secWatchdog.txt[00m
-rw-rw-r-- 1 yangx yangx 1975 Jun 12 16:04 [00mscript_4axisgalil.txt[00m
-rw-rw-r-- 1 yangx yangx 1960 Jun 12 16:04 [00mscript4.txt[00m
-rw-rw-r-- 1 yangx yangx 2051 Jun 12 16:04 [00mscript5_8secWatchdog.txt[00m
-rw-rw-r-- 1 yangx yangx 1979 Jun 12 16:04 [00mscript5.txt[00m
-rw-rw-r-- 1 yangx yangx 2494 Jun 12 16:04 [00mscript_dose.txt[00m
[m[yangx@yangx galil_scripts]$ ls -ltr
[00mtotal 52
-rw-rw-r-- 1 yangx yangx 2494 Jun 12 16:04 [00mscript_dose.txt[00m
-rw-rw-r-- 1 yangx yangx 1979 Jun 12 16:04 [00mscript5.txt[00m
-rw-rw-r-- 1 yangx yangx 2051 Jun 12 16:04 [00mscript5_8secWatchdog.txt[00m
-rw-rw-r-- 1 yangx yangx 1960 Jun 12 16:04 [00mscript4.txt[00m
-rw-rw-r-- 1 yangx yangx 1975 Jun 12 16:04 [00mscript_4axisgalil.txt[00m
-rw-rw-r-- 1 yangx yangx 2032 Jun 12 16:04 [00mscript4_8secWatchdog.txt[00m
-rwxrwxr-x 1 yangx yangx  463 Jun 12 16:04 [00;32mscript3.txt[00m
-rw-rw-r-- 1 yangx yangx 1987 Jun 12 16:04 [00mscript_05jul00.txt[00m
-rw-rw-r-- 1 yangx yangx 2751 Jun 12 16:04 [00mhuber.txt[00m
-rw-rw-r-- 1 yangx yangx 1987 Jun 12 16:04 [00mBL12-2galil9.txt[00m
-rw-rw-r-- 1 yangx yangx 3876 Jul 19 10:28 [00mmicroDiffractometer.txt[00m
-rw-rw-r-- 1 yangx yangx 3876 Aug 23 15:20 [00mmicroDiffractometer-test.txt[00m
-rw-rw-r-- 1 yangx yangx 3946 Oct 11 11:28 [00mmicroDiffractometer-step.txt[00m
[m[yangx@yangx galil_scripts]$ vi microDiffractometer.txt 
[?1049h[?1h=[1;56r[?12;25h[?12l[?25h[27m[m[H[2J[?25l[56;1H"microDiffractometer.txt" "microDiffractometer.txt" 230L, 3876C[>c[1;1H//
//Galil Script for DMC2180
//
// WATCHDOG ROUTINE
[34m#W_Dog[m
ER 10000
OE 1
CW ,1
Kick=0
LastKic=0
[34m#WDog_ok[m
//MG{EF} [31m"WATCHDOG ok"[m
AT 0
AT 5000
JP [34m#WDogBad,Kick=LastKic[m
LastKic=Kick
TimeOut=0
JP [34m#WDog_ok
#WDogBad[m
ST AB
ST S
[34m#close shutter[m
CB 1
TimeOut=1
//DON'T Send an unsolicited message to DHS
//MG{EF} [31m"dtoh_watchdog_timeout"[m
JP [34m#WDog_ok[m
//
//
//This routine closes all sockets after waiting for 1 second.
//The 1 second wait is useful to allow the client to disconnect cleanly.
//
[34m#ShutAll[m
AT 0
AT 1000
IHA=>-2
IHB=>-2
IHC=>-2
IHD=>-2
IHE=>-2
IHF=>-2
EN
//end of the routine
//
//
//
//OSCILLATION CODE
[34m#ShutREV[m
JP [34m#NoShutr,Shutter=0
#Loop2A[m
JP [34m#LoopEnd,StopOsc>0[m
//Get position
JS [34m#RP_axis[m
JP [34m#Loop2A,Pos>OscStart-1[m
JS [34m#OpenSh[m[56;94H1,1           Top[1;1H[?12l[?25hP+q436f\P+q6b75\P+q6b64\P+q6b72\P+q6b6c\P+q2332\P+q2334\P+q2569\P+q2a37\P+q6b31\[?25l[56;94H2,1           Top[2;1H[?12l[?25h[?25l[56;94H3,1           Top[3;1H[?12l[?25h[?25l[56;94H4,1           Top[4;1H[?12l[?25h[?25l[56;94H5,1           Top[5;1H[?12l[?25h[?25l[56;94H6,1           Top[6;1H[?12l[?25h[?25l[56;94H7,1           Top[7;1H[?12l[?25h[?25l[56;94H8,1           Top[8;1H[?12l[?25h[?25l[56;94H9,1           Top[9;1H[?12l[?25h[?25l[56;94H10,1          Top[10;1H[?12l[?25h[?25l[56;94H11,1          Top[11;1H[?12l[?25h[?25l[56;94H12,1          Top[12;1H[?12l[?25h[?25l[56;94H13,1          Top[13;1H[?12l[?25h[?25l[56;94H14,1          Top[14;1H[?12l[?25h[?25l[56;94H15,1          Top[15;1H[?12l[?25h[?25l[56;94H16,1          Top[16;1H[?12l[?25h[?25l[56;94H17,1          Top[17;1H[?12l[?25h[?25l[56;94H18,1          Top[18;1H[?12l[?25h[?25l[56;94H19,1          Top[19;1H[?12l[?25h[?25l[56;94H20,1          Top[20;1H[?12l[?25h[?25l[56;94H19,1          Top[19;1H[?12l[?25h[?25l[56;94H18,1          Top[18;1H[?12l[?25h[?25l[56;94H17,1          Top[17;1H[?12l[?25h[?25l[56;94H16,1          Top[16;1H[?12l[?25h[?25l[56;94H15,1          Top[15;1H[?12l[?25h[?25l[56;94H14,1          Top[14;1H[?12l[?25h[?25l[56;94H13,1          Top[13;1H[?12l[?25h[?25l[56;94H12,1          Top[12;1H[?12l[?25h[?25l[56;94H11,1          Top[11;1H[?12l[?25h[?25l[56;94H10,1          Top[10;1H[?12l[?25h[?25l[56;94H9,1           Top[9;1H[?12l[?25h[?25l[56;94H8,1           Top[8;1H[?12l[?25h[?25l[56;94H7,1           Top[7;1H[?12l[?25h[?25l[56;94H6,1           Top[6;1H[?12l[?25h[?25l[56;94H5,1           Top[5;1H[?12l[?25h[?25l[56;94H4,1           Top[4;1H[?12l[?25h[?25l[56;94H3,1           Top[3;1H[?12l[?25h[?25l[56;94H2,1           Top[2;1H[?12l[?25h[?25l[56;94H1,1           Top[1;1H[?12l[?25h[?25l[56;94H2,1           Top[2;1H[?12l[?25h[?25l[56;94H3,1           Top[3;1H[?12l[?25h[?25l[56;94H4,1           Top[4;1H[?12l[?25h[?25l[56;94H5,1           Top[5;1H[?12l[?25h[?25l[56;94H6,1           Top[6;1H[?12l[?25h[?25l[56;94H7,1           Top[7;1H[?12l[?25h[?25l[56;94H8,1           Top[8;1H[?12l[?25h[?25l[27m[m[H[2J[27m[m[H[2J[1;1HJP [34m#Loop2A,Pos>OscStart-1[m
JS [34m#OpenSh
#Loop3A[m
JP [34m#LoopEnd,StopOsc>0[m
//Get position
JS [34m#RP_axis[m
JP [34m#Loop3A,Pos>OscEnd[m
JP [34m#Finish[m
//
//Shutter handling for non-reversed motor
[34m#ShutFWD[m
JP [34m#NoShutr,Shutter=0
#Loop2B[m
JP [34m#LoopEnd,StopOsc>0[m
//Get position
JS [34m#RP_axis[m
JP [34m#Loop2B,Pos<OscStart+1[m
JS [34m#OpenSh
#Loop3B[m
JP [34m#LoopEnd,StopOsc>0[m
//Get position
JS [34m#RP_axis[m
JP [34m#Loop3B,Pos<OscEnd[m
//
[34m#Finish[m
JS [34m#CloseSh[m
EN
//
[34m#LoopEnd[m
AT 0
AT 1000
JP [34m#Finish[m
//
[34m#OpenSh[m
SB FrontFil
MG{EF} [31m"dtoh_shutter_open"[m,FrontFil
EN
//
[34m#CloseSh[m
CB FrontFil
MG{EF} [31m"dtoh_shutter_closed"[m,FrontFil
[34m#NoShutr[m
EN
//
[34m#RP_axis[m
JP [34m#POS_X,Axis=0[m
JP [34m#POS_Y,Axis=1[m
JP [34m#POS_Z,Axis=2[m
JP [34m#POS_W,Axis=3[m
JP [34m#POS_E,Axis=4[m
JP [34m#POS_F,Axis=5[m
JP [34m#POS_G,Axis=6[m
JP [34m#POS_H,Axis=7[m
// Tell calling program that Axis not in range [0..7]*/
MG{EF} [31m"dtoh_axis_not_in_range"[m[56;94H54,1          30%[1;1H[?12l[?25h[?25l// Tell calling program that Axis not in range [0..7]*/
MG{EF} [31m"dtoh_axis_not_in_range"[m
EN[3;3H[K[4;1H//[4;4H[K[5;1H[34m#POS_X[m[5;7H[K[6;1HPos=_RPX[6;9H[K[7;1HEN[7;4H[K[8;1H[34m#POS_Y[m[8;7H[K[9;1HPos=_RPY
EN[10;3H[K[11;2H[34mPOS_Z[m[11;7H[K[12;1HPos=_RPZ[12;9H[K[13;1HEN[13;3H[K[14;1H[34m#POS_W[m[14;7H[K[15;1HPos=_RPW[15;9H[K[16;1HEN[16;4H[K[17;1H[34m#POS_E[m[17;7H[K[18;1HPos=_RPE[18;9H[K[19;1HEN[19;3H[K[20;1H[34m#POS_F[m[20;7H[K[21;1HPos=_RPF[21;9H[K[22;1HEN[22;4H[K[23;1H[34m#POS_G[m[23;7H[K[24;1HPos=_RPG
EN[25;3H[K[26;1H[34m#POS_H[m[26;7H[K[27;1HPos=_RPH
EN
//Function: ExpServo (Exposure using Phi Servo Motor)
//This script expects the following hardware configuration:
// 1) Phi motor to be on the A axis.
// 2) Direct Output compare shutter control h/w is on I/O channel 1
// 3) Direct shutter control is on I/O channel 2
//Before running, set the following variables:
// ExpStart...Exposure Start: phi location where shutter should open
// ExpEnd...Exposure End: phi location where shutter should close
// ExpVel...Exposure Velocity: speed of the motor during the exposure
// ReadyPos..position from which the phi can ramp up to speed before hitting the ExpStart position.
// OverPos..position to move phi to overshoot the ExpEnd position.
// OcDir..Output compare direction
[34m#Expose[m[41;8H[K[42;1H//Move to ready position
AC~a=600000
DC~a=600000
CB 2[45;5H[K[46;1HCB 1[46;5H[K[47;1H//Disable the output compare while we get into position
OCA=0[48;6H[K[49;1HMG{EF} [31m"log_info Expose start"[m
PA~a=ReadyPos[50;14H[K[51;1HBG~a[51;5H[K[52;1HAM~a[52;5H[K[53;1H//enable the shutter pulse trigger
SB 1[54;5H[K[55;9H[31mlog_info Motor in position"[m[56;94H107,1         60%[1;1H[?12l[?25h[?25l[56;94H108,1         60%[2;1H[?12l[?25h[?25l[56;94H109,1         60%[3;1H[?12l[?25h[?25l[56;94H110,1         60%[4;1H[?12l[?25h[?25l[56;94H111,1         60%[5;1H[?12l[?25h[?25l[56;94H112,1         60%[6;1H[?12l[?25h[?25l[56;94H113,1         60%[7;1H[?12l[?25h[?25l[56;94H114,1         60%[8;1H[?12l[?25h[?25l[56;94H115,1         60%[9;1H[?12l[?25h[?25l[56;94H116,1         60%[10;1H[?12l[?25h[?25l[56;94H117,1         60%[11;1H[?12l[?25h[?25l[56;94H118,1         60%[12;1H[?12l[?25h[?25l[56;94H119,1         60%[13;1H[?12l[?25h[?25l[56;94H120,1         60%[14;1H[?12l[?25h[?25l[56;94H121,1         60%[15;1H[?12l[?25h[?25l[56;94H122,1         60%[16;1H[?12l[?25h[?25l[56;94H123,1         60%[17;1H[?12l[?25h[?25l[56;94H124,1         60%[18;1H[?12l[?25h[?25l[56;94H125,1         60%[19;1H[?12l[?25h[?25l[56;94H126,1         60%[20;1H[?12l[?25h[?25l[56;94H127,1         60%[21;1H[?12l[?25h[?25l[56;94H128,1         60%[22;1H[?12l[?25h[?25l[56;94H129,1         60%[23;1H[?12l[?25h[?25l[56;94H130,1         60%[24;1H[?12l[?25h[?25l[56;94H131,1         60%[25;1H[?12l[?25h[?25l[56;94H132,1         60%[26;1H[?12l[?25h[?25l[56;94H133,1         60%[27;1H[?12l[?25h[?25l[56;94H134,1         60%[28;1H[?12l[?25h[?25l[56;94H135,1         60%[29;1H[?12l[?25h[?25l[56;94H136,1         60%[30;1H[?12l[?25h[?25l[56;94H137,1         60%[31;1H[?12l[?25h[?25l[56;94H138,1         60%[32;1H[?12l[?25h[?25l[56;94H139,1         60%[33;1H[?12l[?25h[?25l[56;94H140,1         60%[34;1H[?12l[?25h[?25l[56;94H141,1         60%[35;1H[?12l[?25h[?25l[56;94H142,1         60%[36;1H[?12l[?25h[?25l[56;94H143,1         60%[37;1H[?12l[?25h[?25l[56;94H144,1         60%[38;1H[?12l[?25h[?25l[56;94H145,1         60%[39;1H[?12l[?25h[?25l[56;94H146,1         60%[40;1H[?12l[?25h[?25l[56;94H147,1         60%[41;1H[?12l[?25h[?25l[56;94H148,1         60%[42;1H[?12l[?25h[?25l[56;94H149,1         60%[43;1H[?12l[?25h[?25l[56;94H150,1         60%[44;1H[?12l[?25h[?25l[56;94H151,1         60%[45;1H[?12l[?25h[?25l[56;94H152,1         60%[46;1H[?12l[?25h[?25l[56;94H153,1         60%[47;1H[?12l[?25h[?25l[56;94H154,1         60%[48;1H[?12l[?25h[?25l[56;94H155,1         60%[49;1H[?12l[?25h[?25l[56;94H156,1         60%[50;1H[?12l[?25h[?25l[56;94H157,1         60%[51;1H[?12l[?25h[?25l[56;94H158,1         60%[52;1H[?12l[?25h[?25l[56;94H159,1         60%[53;1H[?12l[?25h[?25l[56;94H160,1         60%[54;1H[?12l[?25h[?25l[56;94H161,1         60%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H//Enable the output compare to trigger[56;94H[K[56;94H162,1         61%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HOCA=ExpStart,OcDir[56;94H[K[56;94H163,1         61%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HSP~a=ExpVel[56;94H[K[56;94H164,1         62%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HPA~a=OverPos[56;94H[K[56;94H165,1         62%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HMG{EF} [31m"log_info PP~a="[m, OverPos[56;94H[K[56;94H166,1         63%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HBG~a[56;94H[K[56;94H167,1         64%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HXQ [34m#SafeMv,4[m[56;94H[K[56;94H168,1         64%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H//keep waiting until the Output Compare is triggered, opening the shutter[56;94H[K[56;94H169,1         65%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#WAIT1[m[56;94H[K[56;94H170,1         65%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HJP [34m#WAIT1,_OC=0[m[56;94H[K[56;94H171,1         66%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H//reset the output compare (the motor is still moving)[56;94H[K[56;94H172,1         66%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HOCA=ExpEnd,OcDir[56;94H[K[56;94H173,1         67%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H//tell the dhs that the shutter is open[56;94H[K[56;94H174,1         68%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HMG{EF} [31m"dtoh_shutter_open 2"[m[56;94H[K[56;94H175,1         68%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H//keep waiting until the Output Compare is triggered, closing the shutter[56;94H[K[56;94H176,1         69%[55;1H[?12l[?25h[?25l[56;94H175,1         69%[54;1H[?12l[?25h[?25l[56;94H174,1         69%[53;1H[?12l[?25h[?25l[56;94H173,1         69%[52;1H[?12l[?25h[?25l[56;94H172,1         69%[51;1H[?12l[?25h[?25l[56;94H171,1         69%[50;1H[?12l[?25h[?25l[56;94H170,1         69%[49;1H[?12l[?25h[?25l[56;94H169,1         69%[48;1H[?12l[?25h[?25l[56;94H168,1         69%[47;1H[?12l[?25h[?25l[56;94H167,1         69%[46;1H[?12l[?25h[?25l[56;94H166,1         69%[45;1H[?12l[?25h[?25l[56;94H165,1         69%[44;1H[?12l[?25h[?25l[56;94H164,1         69%[43;1H[?12l[?25h[?25l[56;94H163,1         69%[42;1H[?12l[?25h[?25l[56;94H162,1         69%[41;1H[?12l[?25h[?25l[56;94H161,1         69%[40;1H[?12l[?25h[?25l[56;94H160,1         69%[39;1H[?12l[?25h[?25l[56;94H159,1         69%[38;1H[?12l[?25h[?25l[56;94H158,1         69%[37;1H[?12l[?25h[?25l[56;94H157,1         69%[36;1H[?12l[?25h[?25l[56;94H156,1         69%[35;1H[?12l[?25h[?25l[56;94H155,1         69%[34;1H[?12l[?25h[?25l[56;94H154,1         69%[33;1H[?12l[?25h[?25l[56;94H153,1         69%[32;1H[?12l[?25h[?25l[56;94H152,1         69%[31;1H[?12l[?25h[?25l[56;94H151,1         69%[30;1H[?12l[?25h[?25l[56;94H150,1         69%[29;1H[?12l[?25h[?25l[56;94H149,1         69%[28;1H[?12l[?25h[?25l[56;94H148,1         69%[27;1H[?12l[?25h[?25l[56;94H147,1         69%[26;1H[?12l[?25h[?25l[56;94H146,1         69%[25;1H[?12l[?25h[?25l[56;94H145,1         69%[24;1H[?12l[?25h[?25l[56;94H144,1         69%[23;1H[?12l[?25h[?25l[56;94H143,1         69%[22;1H[?12l[?25h[?25l[56;94H142,1         69%[21;1H[?12l[?25h[?25l[56;94H141,1         69%[20;1H[?12l[?25h[?25l[56;94H140,1         69%[19;1H[?12l[?25h[?25l[56;94H139,1         69%[18;1H[?12l[?25h[?25l[56;94H138,1         69%[17;1H[?12l[?25h[?25l[56;94H137,1         69%[16;1H[?12l[?25h[?25l[56;94H136,1         69%[15;1H[?12l[?25h[?25l[56;94H135,1         69%[14;1H[?12l[?25h[?25l[56;94H136,1         69%[15;1H[?12l[?25h[?25l[56;94H137,1         69%[16;1H[?12l[?25h[?25l[56;94H138,1         69%[17;1H[?12l[?25h[?25l[56;94H139,1         69%[18;1H[?12l[?25h[?25l[56;94H140,1         69%[19;1H[?12l[?25h[?25l[56;94H141,1         69%[20;1H[?12l[?25h[?25l[56;94H142,1         69%[21;1H[?12l[?25h[?25l[56;94H143,1         69%[22;1H[?12l[?25h[?25l[56;94H144,1         69%[23;1H[?12l[?25h[?25l[56;94H145,1         69%[24;1H[?12l[?25h[?25l[56;94H146,1         69%[25;1H[?12l[?25h[?25l[56;94H147,1         69%[26;1H[?12l[?25h[?25l[56;94H148,1         69%[27;1H[?12l[?25h[?25l[56;94H149,1         69%[28;1H[?12l[?25h[?25l[56;94H150,1         69%[29;1H[?12l[?25h[?25l[56;94H151,1         69%[30;1H[?12l[?25h[?25l[56;94H150,1         69%[29;1H[?12l[?25h[?25l[56;94H149,1         69%[28;1H[?12l[?25h[?25l[56;94H148,1         69%[27;1H[?12l[?25h[?25l[56;94H147,1         69%[26;1H[?12l[?25h[?25l[56;94H148,1         69%[27;1H[?12l[?25h[?25l[56;94H149,1         69%[28;1H[?12l[?25h[?25l[56;94H150,1         69%[29;1H[?12l[?25h[?25l[56;94H151,1         69%[30;1H[?12l[?25h[?25l[56;94H152,1         69%[31;1H[?12l[?25h[?25l[56;94H153,1         69%[32;1H[?12l[?25h[?25l[56;94H154,1         69%[33;1H[?12l[?25h[?25l[56;94H155,1         69%[34;1H[?12l[?25h[?25l[56;94H156,1         69%[35;1H[?12l[?25h[?25l[56;94H157,1         69%[36;1H[?12l[?25h[?25l[56;94H158,1         69%[37;1H[?12l[?25h[?25l[56;94H159,1         69%[38;1H[?12l[?25h[?25l[56;94H160,1         69%[39;1H[?12l[?25h[?25l[56;94H161,1         69%[40;1H[?12l[?25h[?25l[56;94H162,1         69%[41;1H[?12l[?25h[?25l[56;94H163,1         69%[42;1H[?12l[?25h[?25l[56;94H164,1         69%[43;1H[?12l[?25h[?25l[56;94H165,1         69%[44;1H[?12l[?25h[?25l[56;94H166,1         69%[45;1H[?12l[?25h[?25l[56;94H167,1         69%[46;1H[?12l[?25h[?25l[56;94H168,1         69%[47;1H[?12l[?25h[?25l[56;94H169,1         69%[48;1H[?12l[?25h[?25l[56;94H170,1         69%[49;1H[?12l[?25h[?25l[56;94H171,1         69%[50;1H[?12l[?25h[?25l[56;94H172,1         69%[51;1H[?12l[?25h[?25l[56;94H173,1         69%[52;1H[?12l[?25h[?25l[56;94H174,1         69%[53;1H[?12l[?25h[?25l[56;94H175,1         69%[54;1H[?12l[?25h[?25l[56;94H176,1         69%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H[34m#WAIT2[m[56;94H[K[56;94H177,1         69%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HJP [34m#WAIT2,_OC=0[m[56;94H[K[56;94H178,1         70%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H//tell the dhs that the shutter is closed[56;94H[K[56;94H179,1         70%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1HMG{EF} [31m"dtoh_shutter_closed 2"[m[56;94H[K[56;94H180,1         71%[55;1H[?12l[?25h[?25l[1;55r[55;1H
[1;56r[55;1H//stop the motor[56;94H[K[56;94H181,1         72%[55;1H[?12l[?25h[?25l